# L7benchmark - é«˜æ€§èƒ½ç¶²ç«™å£“åŠ›æ¸¬è©¦å·¥å…·

L7benchmark æ˜¯ä¸€å€‹éˆæ´»ã€é«˜æ•ˆçš„ HTTP/HTTPS å£“åŠ›æ¸¬è©¦å·¥å…·ï¼Œå°ˆç‚ºç¶²ç«™æ€§èƒ½è©•ä¼°å’Œè² è¼‰æ¸¬è©¦è¨­è¨ˆã€‚é€šééåŒæ­¥ IO å¯¦ç¾é«˜ä½µç™¼è«‹æ±‚è™•ç†ï¼Œèƒ½å¤ æ¨¡æ“¬çœŸå¯¦ä¸–ç•Œä¸­çš„ä½¿ç”¨è€…è¡Œç‚ºã€‚

## ğŸš€ ä¸»è¦ç‰¹é»

- **é«˜ä½µç™¼è™•ç†**ï¼šåŸºæ–¼ Python çš„ asyncio å’Œ aiohttpï¼Œå¯¦ç¾é«˜æ•ˆçš„éåŒæ­¥è«‹æ±‚è™•ç†
- **å¯è‡ªè¨‚çš„æ¸¬è©¦é…ç½®**ï¼šéˆæ´»èª¿æ•´ä¸¦ç™¼é€£æ¥æ•¸ã€æ¸¬è©¦æ™‚é•·ç­‰åƒæ•¸
- **è©³ç´°çš„å¯¦æ™‚çµ±è¨ˆ**ï¼šæä¾›å³æ™‚çš„è«‹æ±‚æˆåŠŸç‡å’Œåˆ†ä½ˆè³‡è¨Š
- **éˆæ´»çš„ Profile ç³»çµ±**ï¼šå¯ç·¨å¯«å°ˆå±¬æ¸¬è©¦æ¨¡å¼ï¼Œé‡å°ç‰¹å®šç¶²ç«™é€²è¡Œé‡å°æ€§æ¸¬è©¦
- **æ”¯æ´ SNI å’Œè‡ªè¨‚ Headers**ï¼šæ»¿è¶³å„ç¨®ç¶²ç«™æ¸¬è©¦éœ€æ±‚
- **IP è¦†è“‹åŠŸèƒ½**ï¼šå¯ç¹é DNS è§£æï¼Œç›´æ¥æŒ‡å‘ç‰¹å®š IP

## ğŸ“‹ å‘½ä»¤è¡Œåƒæ•¸

| åƒæ•¸ | æè¿° |
|------|------|
| `-u, --url` | æ¸¬è©¦ç›®æ¨™ URL (å¿…å¡«) |
| `-c, --connection` | ä¸¦ç™¼é€£æ¥æ•¸ (é è¨­: 10) |
| `--ip` | è¦†è“‹ DNS è§£æï¼Œç›´æ¥ä½¿ç”¨æŒ‡å®š IP |
| `-t, --time` | æ¸¬è©¦æŒçºŒæ™‚é–“ (ç§’ï¼Œé è¨­: 10) |
| `-b, --body` | ä¸‹è¼‰å›æ‡‰å…§å®¹ (é è¨­ä¸ä¸‹è¼‰) |
| `--shared-session` | æ‰€æœ‰ worker å…±äº«å–®ä¸€ client sessionï¼ˆä¸å»ºè­°ä½¿ç”¨ï¼‰|
| `-H, --header` | æ·»åŠ è‡ªè¨‚ headerï¼Œæ ¼å¼ç‚º 'Name: Value' (å¯å¤šæ¬¡ä½¿ç”¨) |
| `-p, --profile` | æŒ‡å®šæ¸¬è©¦æ¨¡å¼æª”æ¡ˆè·¯å¾‘ (é è¨­: ./profiles/default.py) |
| `-X, --method` | æŒ‡å®š HTTP æ–¹æ³• (GET, POST, PUT, DELETE, HEAD, OPTIONS) |

## ğŸ’¡ Profile ç³»çµ±ä»‹ç´¹

L7benchmark æœ€å¼·å¤§çš„åŠŸèƒ½æ˜¯å…¶ Profile ç³»çµ±ï¼Œå®ƒå…è¨±ä½¿ç”¨è€…ç‚ºç‰¹å®šç¶²ç«™ç·¨å¯«å®¢è£½åŒ–çš„æ¸¬è©¦æ¨¡å¼ã€‚

### Profile ç³»çµ±çš„å„ªå‹¢

1. **éˆæ´»æ€§**ï¼šå¯ä»¥é‡å°ç¶²ç«™çš„ç‰¹å®šéƒ¨åˆ†æˆ–åŠŸèƒ½é€²è¡Œæ¸¬è©¦
2. **æ¨¡æ“¬çœŸå¯¦ç”¨æˆ¶è¡Œç‚º**ï¼šå¯ç·¨ç¨‹æ€§å…è¨±æ¨¡æ“¬ç”¨æˆ¶çš„ç€è¦½æ¨¡å¼å’Œæ“ä½œæµç¨‹
3. **ç‹€æ…‹è·Ÿè¸ª**ï¼šæ”¯æ´æ ¹æ“šä¸Šä¸€æ¬¡è«‹æ±‚çš„çµæœå‹•æ…‹ç”Ÿæˆä¸‹ä¸€æ¬¡è«‹æ±‚
4. **æ˜“æ–¼æ“´å±•**ï¼šç°¡å–®çš„ Python é¡ç¹¼æ‰¿æ©Ÿåˆ¶ï¼Œå®¹æ˜“é–‹ç™¼æ–°çš„æ¸¬è©¦æ¨¡å¼

### å¦‚ä½•ç·¨å¯«è‡ªå·±çš„ Profile

æ¯å€‹ Profile éƒ½å¿…é ˆç¹¼æ‰¿ `BaseProfile` é¡ï¼Œä¸¦å¯¦ç¾ `generate_request` æ–¹æ³•ï¼Œè©²æ–¹æ³•æ‡‰è¿”å›ä¸€å€‹ `RequestInfo` å°è±¡ï¼š

```python
class MyCustomProfile(BaseProfile):
    def __init__(self, args: Args, first_url: str, hostname: str):
        super().__init__(args=args, first_url=first_url, hostname=hostname)
        # åˆå§‹åŒ–è‡ªå·±çš„ç‹€æ…‹
        
    def generate_request(self, worker_id: int, last_url: Optional[str], last_status_code: Optional[int]) -> RequestInfo:
        # æ ¹æ“šéœ€è¦ç”Ÿæˆä¸‹ä¸€å€‹è«‹æ±‚
        return RequestInfo(
            method=HttpMethod.GET,
            url="https://example.com/path",
            hostname=self.hostname,
            headers=self.custom_headers,
            body=None
        )

# å‹™å¿…å°å‡ºä½ çš„ Profile é¡
ExportedProfile = MyCustomProfile
```

generate_request æ–¹æ³•å°‡æœƒåœ¨æ¸¬è©¦ä¸­è¢«æˆåƒä¸Šè¬æ¬¡èª¿ç”¨ï¼Œå› æ­¤æ‡‰è©²ä¿æŒé«˜æ•ˆã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `last_url` å’Œ `last_status_code` ä¾†æ±ºå®šä¸‹ä¸€å€‹è«‹æ±‚çš„ URL å’Œæ–¹æ³•ã€‚

## ğŸŒŸ ä½¿ç”¨ç¯„ä¾‹

åŸºæœ¬ç”¨æ³•ï¼š
```bash
python l7benchmark.py -u https://example.com -c 50 -t 30
```

ä½¿ç”¨è‡ªè¨‚ Profile å’Œ Headersï¼š
```bash
python l7benchmark.py -u https://example.com -p ./profiles/my_profile.py -H "User-Agent: Mozilla/5.0" -H "Accept-Language: zh-TW"
```

æŒ‡å®š IP å’Œ POST æ–¹æ³•ï¼š
```bash
python l7benchmark.py -u https://example.com --ip 203.0.113.1 -X POST
```

## ğŸ“ˆ çµæœè§£è®€

æ¸¬è©¦çµæŸå¾Œï¼ŒL7benchmark æœƒé¡¯ç¤ºè©³ç´°çš„çµæœçµ±è¨ˆï¼š
- ç¸½è«‹æ±‚æ•¸
- å„ç¨® HTTP ç‹€æ…‹ç¢¼çš„åˆ†ä½ˆ (2xx, 3xx, 4xx, 5xx)
- æ¸¬è©¦ç¸½æ™‚é•·

é€™äº›è³‡è¨Šå¯å¹«åŠ©æ‚¨å…¨é¢äº†è§£ç¶²ç«™åœ¨è² è¼‰ä¸‹çš„è¡¨ç¾ï¼Œè­˜åˆ¥æ½›åœ¨çš„æ€§èƒ½ç“¶é ¸å’Œç©©å®šæ€§å•é¡Œã€‚
